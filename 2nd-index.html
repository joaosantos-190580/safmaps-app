<!DOCTYPE html>
<html>
<head>

    <title>Protótipo - DBMS</title>
	
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">	
	
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <link rel="stylesheet" href="./css/leaflet-routing-machine.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <style>
		html, body {
			height: 100%;
			margin: 0;
		}

		#map {
			width: 100%;
			height: 100%;
		}
		
		.leaflet-control-geocoder-icon {
			width: 44px !important;
			height: 44px !important;
		}

		.leaflet-routing-container {
			display: none;
			margin-right: 4.8em !important;
			margin-top: -3.9em !important;
		}

		.geocoder-icon-none {
			background-image: none;
			background-color: white;
		}
    </style>
</head>
<body>
    <div id="map" class="map"></div>
	<!--
		<div class="leaflet-top leaflet-right" style="margin-top:1.2em; margin-right:1.5em">
			<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style="">
				<button class="leaflet-control-geocoder-icon" type="button" style=""><i class="fa fa-times" style="display:none; color:red; margin-left:-.1em"></i></button>
			</div>
		</div>
	-->
		
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYiHZL4JLYBrDqquu3EeaErg8LiZ_WFPo"></script>

    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
    <script src="./js/leaflet-routing-machine.min.js"></script>
	<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

	<script>
		(function() {
			var estudo_caso = L.layerGroup();
			var estados = L.layerGroup();
			var uso_cobertura = L.layerGroup();
			var declividade = L.layerGroup();
			var reservas = L.layerGroup();
			var eucalipto = L.layerGroup();

			// Pontos de referência
			L.marker([-22.356615, -46.976338]).bindPopup('International Paper').addTo(estudo_caso),
			L.marker([-19.965763, -44.094803]).bindPopup('REGAP').addTo(estudo_caso),
			L.marker([-23.186327, -45.837129]).bindPopup('REVAP').addTo(estudo_caso);

			var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
					'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

			var map = L.map('map').setView([-12.7894, -51.1708], 5);
			
			var streets = L.tileLayer(mbUrl, {
				id: 'mapbox.streets', 
				attribution: mbAttr
			}).addTo(map);

			var baseLayers = {
				"Mapa de Fundo": streets
			};

			var overlays = {
				"Estudo Caso"			: estudo_caso,
				"Estados Relevantes"	: estados,
				"Mapa Uso e Cobertura"	: uso_cobertura,
				"Mapa de Declividade"	: declividade,
				"Áreas de conservação"	: reservas,
				"Aptidão Eucalipto"		: eucalipto,
			};

			L.control.layers(baseLayers, overlays).addTo(map);	
			
			control = L.Routing.control({
				showAlternatives: true,
				autoRoute: true,		
				waypoints: [],
				routeWhileDragging: true,
				geocoder: L.Control.Geocoder.nominatim()
			}).addTo(map);
			
			// Manipulate controls for Route/Geocoder
			$("div.leaflet-control-container").append('<div id="control-geocoder" class="leaflet-top leaflet-right" style="top:4.5em !important; z-index:700 !important"></div>');
			$("#control-geocoder").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style=""><button class="leaflet-control-geocoder-icon" type="button" style=""><i class="fa fa-times" style="display:none; color:red; margin-left:-.1em"></i></button></div>');
			$("div.leaflet-routing-container").detach().appendTo("#control-geocoder");
			
			map.on('click', function(e) {
				if ($("div.leaflet-routing-container").css("display") !== 'none') {
					// Adding new routes to the array
					if (control.getWaypoints()[0].name == '') {
						control.spliceWaypoints(0, 1, e.latlng);
					} else {
						control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng);
					}
				} else {
					
				}
			});
			
			$("button.leaflet-control-geocoder-icon").on("click", function() {
				if ($("div.leaflet-routing-container").css("display") == 'none') {
					$("div.leaflet-routing-container").css("display", "block");
					
					// Reset route
					control.getPlan().setWaypoints([]);
				} else {
					$("div.leaflet-routing-container").css("display", "none");
				}
			});
		})();

	</script>
</body>
</html>