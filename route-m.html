<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Protótipo - DBMS (Rotas)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="./css/leaflet-routing-machine.css" />
    <style>
        .map {
            position: absolute;
            width: 98%;
            height: 98%;
        }
    </style>
</head>
<body>
    <div id="map" class="map"></div>
	
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYiHZL4JLYBrDqquu3EeaErg8LiZ_WFPo"></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="./js/leaflet-routing-machine.min.js"></script>

	<script>
	/*
		var map = L.map('map');
		L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}{r}.png', {
			attribution: '© OpenStreetMap contributors'
		}).addTo(map);
	*/

		var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
				'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
			mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

		// var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
		var streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});
	
		var map = L.map('map', {
			center: [-12.7894, -51.1708],
			zoom: 5,
			layers: [streets]
		});		

	/*	EXEMPLO ORIGINAL
		L.Routing.control({
			waypoints: [
				L.latLng(-22.356615, -46.976338),
				L.latLng(-22.331500, -46.996272)
			],
			routeWhileDragging: true
		}).addTo(map);	
	*/

		control = L.Routing.control({
			/*
				router: L.Routing.mapbox(config.features.routing.key),     
				formatter: L.Routing.formatter({
					language: 'pt-br',
					//units: config.features.routing.units
				}),
			*/
			showAlternatives: true,
			autoRoute: true,		
			waypoints: [],
			routeWhileDragging: true
		}).addTo(map);

		function createButton(label, container) {
			var btn = L.DomUtil.create('button', '', container);
			btn.setAttribute('type', 'button');
			btn.innerHTML = label;
			return btn;
		}

		map.on('click', function(e) {
			var container = L.DomUtil.create('div'),
				startBtn = createButton('Start from this location', container),
				destBtn = createButton('Go to this location', container);

			L.popup()
				.setContent(container)
				.setLatLng(e.latlng)
				.openOn(map);
			
			L.DomEvent.on(startBtn, 'click', function() {
				control.spliceWaypoints(0, 1, e.latlng);
				map.closePopup();
			});
			
			L.DomEvent.on(destBtn, 'click', function() {
				control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng);
				map.closePopup();
			});			
		});	
	
	</script>
</body>
</html>