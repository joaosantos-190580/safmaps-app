<!DOCTYPE html>
<html>
<head>

    <title>DBMS Boeing - v0</title>
	
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0-12/css/fontawesome.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0-12/css/brands.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0-12/css/solid.min.css" />

	<!-- loading jsPanel css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jspanel3/3.11.0/jquery.jspanel.css"/>
	
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <link rel="stylesheet" href="./css/leaflet-routing-machine.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">

    <style>
		html, body {
			height: 100%;
			margin: 0;
		}

		#map {
			width: 100%;
			height: 100%;
		}
		
		/* 
			.leaflet-control-geocoder-icon {
				width: 44px !important;
				height: 44px !important;
			}
		*/

		.leaflet-routing-container {
			display: none;
			margin-right: 3.5em !important;
			margin-top: -2.8em !important;
		}

		.leaflet-draw {
			display: none;
		}
		
		.leaflet-control-draw-icon {
			background-color: white;
		}
		
		.leaflet-control-info-icon {
			background-color: white;
		}
		
		.leaflet-control-costs-icon {
			background-color: white;
		}
		
		.leaflet-control-productivity-icon {
			background-color: white;
		}
		
		#other-controls {
			bottom: 2em !important;
			left: 2em !important;
		}
		
		.panel-info {
			width: 350px;
			height: 200px;
			left: 4.5em;
			top: 10em;
			background-color: white;
			border-block: black;
			border-style: groove;
			display: none;
			text-align: center;
		}

		.panel-costs {
			width: 350px;
			height: 200px;
			left: 4.5em;
			top: 30em;
			background-color: white;
			border-block: black;
			border-style: groove;
			display: none;
			text-align: center;
		}
		
		.panel-prod {
			width: 350px;
			height: 200px;
			left: 95em;
			top: 40em;
			background-color: white;
			border-block: black;
			border-style: groove;
			display: none;
			text-align: center;
		}
		
		.panel-header {
			width: 96%;
			height: 20px;
			margin: 2px 2px;
			text-align: left;
			border-style: solid;
			border-width: thin;
			background-color: darkslategray;
			color: white;
			padding: 5px;
		}

		.jsPanel {
			/*	z-index: 700 !important;	*/
			z-index: 1000 !important;
		}

		.div-steps {
			position: relative;
			padding-left: 1em;
			width: 95%;
			height: 100%;			
		}

		.bt-style {
			border-width: thin;
			cursor: pointer;
			border-radius: 3px;
		}

		.bt-cstudy {
			position: absolute;
			width: 6em;
			height: 1.5em;
			bottom: 2.5em;
			right: 1.5em;
		}

		.bt-back {
			position: absolute;
			width: 4em;
			height: 1.5em;
			bottom: 1.5em;
			left: 0.5em;
		}

		.bt-next {
			position: absolute;
			width: 4em;
			height: 1.5em;
			bottom: 1.5em;
			right: 1em;
		}

		.bt-calc {
			position: absolute;
			width: 4em;
			height: 1.5em;
			bottom: 1.5em;
			right: 1.8em;
		}

		.bt-comparision {
			position: absolute;
			width: 4em;
			height: 1.5em;
			bottom: 0.4em;
			right: 4em;
		}

		.bt-restart {
			position: absolute;
			height: 1.5em;
			bottom: 0.4em;
			right: 1em;
		}

		.tooltip {
			position: relative;
			display: inline-block;
			border-bottom: 1px dotted black;
		}

		.tooltip .tooltiptext {
			visibility: hidden;
			width: 120px;
			background-color: black;
			color: #fff;
			text-align: center;
			border-radius: 6px;
			padding: 5px 0;

			/* Position the tooltip */
			position: absolute;
			z-index: 1;
		}

		.tooltip:hover .tooltiptext {
			visibility: visible;
		}

		.leaflet-control-zoom {
			top: 6em !important;
    		left: 2em !important;
		}
    </style>
	<script>
		var editableLayers, drawLayer;
	</script>
</head>
<body>
	<div style="height:100%;background-color: #041b3a;">
		<!--
			<div id="banner" style="border-radius:2px; width:100%;height:5%;background-image: linear-gradient(to right, white,#041b3a);">
					<img src='images/logo_boeing.png' height='100%' style="margin-left:2em;">
			</div>
		-->
		<div id="banner" style="border-radius: 25px;width: 70%;height: 1%;background-image: linear-gradient(to right, #93bd42,#041b3a);margin-left: 5em;"></div>
		<div style="border-radius: 55px;width: 30%;height: 8%;z-index: 1000 !important;position: absolute;margin-left: 1em;top: 0.2em;">
				<img src="images/logo_dbms_opt_2.png" height="100%">
		</div>		
		<div id="map" class="map" style="border-radius:2px;height:99%"></div>
	</div>
		
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYiHZL4JLYBrDqquu3EeaErg8LiZ_WFPo"></script>

    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
    <script src="./js/leaflet-routing-machine.min.js"></script>
	<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

	<!-- Load Esri Leaflet from CDN -->
	<script src="https://unpkg.com/esri-leaflet@2.3.0/dist/esri-leaflet.js"	integrity="sha512-1tScwpjXwwnm6tTva0l0/ZgM3rYNbdyMj5q6RSQMbNX6EUMhYDE3pMRGZaT41zHEvLoWEK7qFEJmZDOoDMU7/Q==" crossorigin=""></script>

	<!-- loading jsPanel javascript -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspanel3/3.11.0/jquery.jspanel-compiled.min.js"></script>

    <script type="text/javascript" charset="UTF-8" src="./js/flot/jquery.flot.js"></script>
    <script type="text/javascript" charset="UTF-8" src="./js/flot/jquery.flot.symbol.js"></script>
    <script type="text/javascript" charset="UTF-8" src="./js/flot/jquery.flot.categories.js"></script>
    <script type="text/javascript" charset="UTF-8" src="./js/flot/jquery.flot.axislabels.js"></script>
	<script type="text/javascript" charset="UTF-8" src="./js/flot/jquery.flot.lines.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

	<script>
		(function() {
			// VARIABLE STATEMENTS
			var windowHeight = getActualHeight(), windowWidth = getActualWidth();

			var route = '', feedstock = '';
			var revap = '', espigao = '';

			var curva_oferta_png = '', resultado_png = '';
			var tipo_instalacao = '', capacidade = '';

			var leg_w = '', leg_h = '', leg_pos_l = '', leg_pos_h = '';
			var legend_img_src = '';

			var estudo_caso_1 = L.layerGroup();
			var estudo_caso_2 = L.layerGroup();
//			var areas_atividade4 = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: '	DBMS:areas_atividade4_co-locating_vale_paraiba', format: 'image/png', transparent: true }).addTo(estudo_caso);
//			var reservas = L.layerGroup();

			// MAP PARAMETERS
			//var init_map = [-12.7894, -51.1708];					// original
			var init_map = [-13.7894, -54.1708];
			var init_zoom = 5;

			// LAYERS (Switcher)
			l_estados_src =  'DBMS:estados_relevantes';
			l_municipios_src = 'DBMS:municipios_relevantes';
			l_uso_cobertura_src = 'DBMS:mapbiomas_2018';
			l_declividade_src = 'DBMS:SRTM_declividade';
			l_areas_no_go_src = 'DBMS:areas_no_go';

			// OUTRAS LAYERS
			var l_aptidao_eucalipto = 'DBMS:pastagem_eucalipto';
			var l_custos_eucalipto = 'DBMS:custos_eucalipto';
			var l_produtividade_eucalipto = 'DBMS:produtividade_eucalipto';
								
			var l_espigao = [-22.190487, -51.335236];
			var l_espigao_buffer_50km = 'DBMS:espigao_buffer_50km';

			l_revap = [-23.186327, -45.837129];
			var l_revap_buffer_50km = 'DBMS:revap_buffer_50km';

			var  l_custos_espigao = 'DBMS:custos_espigao_50km';
			var  l_custos_revap = 'DBMS:custos_revap_50km';

			// CHAMADA LAYERS (Switcher)
			var estados = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_estados_src, format: 'image/png', transparent: true });
			var municipios = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_municipios_src, format: 'image/png', transparent: true });
			var uso_cobertura = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_uso_cobertura_src, format: 'image/png', transparent: true });
			var declividade = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_declividade_src, format: 'image/png', transparent: true });
//			var declividade_c = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: 'DBMS:SRTM_declividade_color', format: 'image/png', transparent: true });
			var areas_no_go = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_areas_no_go_src, format: 'image/png', transparent: true });
		
		/*
			var pastagem_declividade = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:pastagem_declividade', format: 'image/png', transparent: true });

			var eucalipto_solo = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:eucalipto_sp_mg_solo', format: 'image/png', transparent: true });
			var eucalipto_solo_pontos = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:eucalipto_sp_mg_solo_pontos', format: 'image/png', transparent: true });
			var eucalipto_geral = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:eucalipto_sp_mg_geral', format: 'image/png', transparent: true });

			var revap_buffer = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:revap_buffer_300km', format: 'image/png', transparent: true });
			var espigao_buffer = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:espigao_buffer_300km', format: 'image/png', transparent: true });

			var aptidao_eucalipto = L.tileLayer.wms('http://localhost:8181/geoserver/ows?', { layers: 'DBMS:aptidao_eucalipto', format: 'image/png', transparent: true });
		*/

			// Pontos de referência
			//L.marker([-22.356615, -46.976338]).bindPopup('International Paper').addTo(estudo_caso),
			//L.marker([-19.965763, -44.094803]).bindPopup('REGAP').addTo(estudo_caso),
			//L.marker([-23.186327, -45.837129]).bindPopup('REVAP').addTo(estudo_caso_1);
			//L.marker([-22.190487, -51.335236]).bindPopup('ESPIGÃO').addTo(estudo_caso_2);

			var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
					'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

		/*
			var streets = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
					'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				id: 'mapbox/streets-v11',
				tileSize: 512,
				zoomOffset: -1
			});
		*/

			var streets = L.tileLayer(mbUrl, {
				id: 'mapbox.streets', 
				attribution: mbAttr
			});

//			}).addTo(map);
//			map.addLayer(streets);

			var imagery = L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
			
			var imagery_group = L.layerGroup();
			L.esri.basemapLayer('Imagery').addTo(imagery_group);
			L.esri.basemapLayer('ImageryLabels').addTo(imagery_group);
			//map.addLayer(imagery_group);

			//var map = L.map('map').setView([-12.7894, -51.1708], 5);
			var map = L.map('map', {
				center: init_map,
				zoom: init_zoom,
				layers: [imagery_group]
			});

			var baseLayers = {
				"Satellite (Hybrid)"		: imagery_group
			//	"Satellite"					: imagery,
			//	"Streets"					: streets
			};

			// VARIAVEIS - LEGENDA
			var layers_avail = {
				estados		: {
					title		: "States considered",
					visible		: false,
					id_panel	: null,
					img_h		: 0
				},
				municipios	: {
					title		: "Municipalities",
					visible		: false,
					id_panel	: null,
					img_h		: 0
				},
				uso_cobertura	: {
					title		: "Land use and land cover (2018)",
					visible		: false,
					id_panel	: null
				},
				declividade	: {
					title		: "Slope",
					visible		: false,
					id_panel	: null
				},
				areas_no_go	: {
					title		: "No-Go Areas (Biodiversity Conservation)",
					visible		: false,
					id_panel	: null,
					img_h		: 0
				},
				aptidao_eucalipto : {
					title		: "Eucalyptus suitability",
					visible		: false,
					id_panel	: null
				},
				custos_eucalipto : {
					title		: "Cost of harvested wood",
					visible		: false,
					id_panel	: null
				},
				produtividade_eucalipto : {
					title		: "Wood yield",
					visible		: false,
					id_panel	: null
				},
				custos_eucalipto_transporte : {
					title		: "Costs of eucalyptus delivered",
					visible		: false,
					id_panel	: null
				}
			};

			var overlays = {
				'Land use and land cover (2018)'			: uso_cobertura,
				'Slope'										: declividade,
				'Municipalities'							: municipios,
				'States considered'							: estados,
				'No-Go Areas (Biodiversity Conservation)'	: areas_no_go
			/*
				"REVAP"									: estudo_caso_1,
				"Buffer REVAP (300km)"					: revap_buffer,
				"ESPIGÃO"								: estudo_caso_2,
				"Buffer ESPIGÃO (300km)"				: espigao_buffer
			*/
			};

			// var layersAptidao = {
			// 	"Aptidão Eucalipto"						: aptidao_eucalipto
			// };

			L.control.layers(baseLayers, overlays).addTo(map);	
//			map.addLayer(estados);
//			map.addLayer(aptidao_eucalipto);

			// Map scale control
			L.control.scale().addTo(map);
			
			control = L.Routing.control({
				showAlternatives: true,
				autoRoute: true,		
				waypoints: [],
				routeWhileDragging: true,
				geocoder: L.Control.Geocoder.nominatim()
			}).addTo(map);
			
			// Manipulate control for Route/Geocoder
			// ESTA COM DISPLAY: NONE
			$("div.leaflet-control-container").append('<div id="geocoder-control" class="leaflet-top leaflet-right" style="display:none;top:5em !important; z-index:700 !important"></div>');
			$("#geocoder-control").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style=""><button class="leaflet-control-geocoder-icon" type="button" style=""></button></div>');
			$("div.leaflet-routing-container").detach().appendTo("#geocoder-control");

			// Manipulate control for Draw
			// ESTA COM DISPLAY: NONE
			$("div.leaflet-control-container").append('<div id="draw-control" class="leaflet-top leaflet-right" style="display:none;top:8em !important; z-index:700 !important"></div>');
			$("#draw-control").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style=""><button class="leaflet-control-draw-icon" type="button" style="background-color:white;border-width:0; margin-top:.5em; width:100%; cursor: pointer"><i class="fas fa-draw-polygon"></i></button></div>');

		/* Botões desabilitados temporariamente

			// Manipulate other controls (informative windows)
			$("div.leaflet-bottom.leaflet-left").attr("id", "other-controls");
			$("#other-controls").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style="margin-bottom:.5em"><button class="leaflet-control-info-icon" type="button" style="border-width:0; margin-top:.5em; width:100%; cursor: pointer"><i class="fas fa-info"></i></button></div>');
			$("#other-controls").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style="margin-left: 4em; margin-bottom: -4em;"><button class="leaflet-control-costs-icon" type="button" style="border-width:0; margin-top:.5em; width:100%; cursor: pointer"><i class="fas fa-coins"></i></button></div>');
			$("#other-controls").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style=""><button class="leaflet-control-prod-icon" type="button" style="border-width:0; margin-top:.5em; width:100%; cursor: pointer"><i class="fas fa-industry"></i></button></div>');
			
			// Manipulate panel-info
			$("div.leaflet-control-container").append('<div id="panel-info" class="leaflet-top leaflet-left panel-info" style=""><div class="panel-header"><b>Painel de Informações</b></div><div style="margin-top:3em"><img src="./images/em_construcao.png" style="width:20%"></div></div>');

			// Manipulate panel-costs
			$("div.leaflet-control-container").append('<div id="panel-costs" class="leaflet-top leaflet-left panel-costs" style=""><div class="panel-header"><b>Painel de Custos</b></div><div style="margin-top:3em"><img src="./images/em_construcao.png" style="width:20%"></div></div>');
			
			// Manipulate panel-prod
			$("div.leaflet-control-container").append('<div id="panel-prod" class="leaflet-top leaflet-left panel-prod" style=""><div class="panel-header"><b>Painel de Produtividade</b></div><div style="margin-top:3em"><img src="./images/em_construcao.png" style="width:20%"></div></div>');
		*/

			// Manipulate panel-areas - MUDAR PARA TOP 11em
			$("div.leaflet-control-container").append('<div id="areas-control" class="leaflet-top leaflet-right" style="top:5em !important; z-index:700 !important"></div>');
			$("#areas-control").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control tooltip"><button class="leaflet-control-prod-icon" type="button" style="background-color:white;border-width:0; margin-top:.5em; width:100%; cursor: pointer"><i class="fas fa-industry"></i></button></div>');

			//$("div.leaflet-control-container").append('<div id="tooltip" class="leaflet-top leaflet-right" style="top:5em !important; z-index:700 !important;text-align:center"></div>');
			//$("#tooltip").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style="right:3em;width:6em"><span><b>Case Study</b></span></div>');

		/*
			// Manipulate panel-areas - Grafico (Provisorio)
			$("div.leaflet-control-container").append('<div id="graph-control" class="leaflet-top leaflet-right" style="top:14em !important; z-index:700 !important"></div>');
			$("#graph-control").append('<div class="leaflet-control-geocoder leaflet-bar leaflet-control" style=""><button class="leaflet-control-graph-icon" type="button" style="border-width:0; margin-top:.5em; width:100%; cursor: pointer"><i class="fas fa-info"></i></button></div>');
		*/

			// Initialise the FeatureGroup to store editable layers
			//var editableLayers = new L.FeatureGroup();
			//map.addLayer(editableLayers);
			//var editableLayers = new L.geoJson().addTo(map);
			editableLayers = new L.FeatureGroup().addTo(map);
			drawLayer = new L.geoJson();
			editableLayers.addLayer(drawLayer);

			var drawPluginOptions = {
			  position: 'topleft',
			  draw: {
				polygon: {
				  //allowIntersection: false, // Restricts shapes to simple polygons
				  drawError: {
					color: '#e1e100', // Color the shape will turn when intersects
					message: '<strong>Oh snap!<strong> you can\'t draw that!' // Message that will show when intersect
				  },
				  shapeOptions: {
					color: '#97009c'
				  }
				},
				// disable toolbar item by setting it to false
				polyline: false,
				circle: true, // Turns off this drawing tool
				rectangle: true,
				marker: false,
				},
			  edit: {
				featureGroup: editableLayers, //REQUIRED!!
			  }
			};

			// Initialise the draw control and pass it the FeatureGroup of editable layers
			var drawControl = new L.Control.Draw(drawPluginOptions).addTo(map);
			//map.addControl(drawControl);

			//var editableLayers = new L.FeatureGroup();
			//map.addLayer(editableLayers);

			//map.on('draw:created', function(e) {
			map.on(L.Draw.Event.CREATED, function (e) {
			  var type = e.layerType,
				layer = e.layer;

			  if (type === 'marker') {
				layer.bindPopup('A popup!');
			  }

			  editableLayers.addLayer(layer);
			});

			L.EditToolbar.Delete.include({
				removeAllLayers: false
			});
			
			map.on('click', function(e) {
				if ($("div.leaflet-routing-container").css("display") !== 'none') {
					// Adding new routes to the array
					if (control.getWaypoints()[0].name == '') {
						control.spliceWaypoints(0, 1, e.latlng);
					} else {
						control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng);
					}
				} else {
					
				}
			});
			
			$("button.leaflet-control-geocoder-icon").on("click", function() {
				if ($("div.leaflet-routing-container").css("display") == 'none') {
					$("div.leaflet-routing-container").css("display", "block");
					
					// Reset route
					//control.getPlan().setWaypoints([]);
				} else {
					$("div.leaflet-routing-container").css("display", "none");
				}
			});
			
			$("button.leaflet-control-draw-icon").on("click", function() {
				if ($("div.leaflet-draw").css("display") == 'none') {
					$("div.leaflet-draw").css("display", "block");
					
					// Reset drawings
					
				} else {
					$("div.leaflet-draw").css("display", "none");
				}
			});
			
		/* Botões desabilitados temporariamente

			$("button.leaflet-control-info-icon").on("click", function() {
				if ($("#panel-info").css("display") == 'none') {
					$("#panel-info").css("display", "block");
					
					// Reset drawings
					
				} else {
					$("#panel-info").css("display", "none");
				}
			});

			$("button.leaflet-control-costs-icon").on("click", function() {
				if ($("#panel-costs").css("display") == 'none') {
					$("#panel-costs").css("display", "block");
					
					// Reset drawings
					
				} else {
					$("#panel-costs").css("display", "none");
				}
			});
		*/

			$("button.leaflet-control-prod-icon").on("click", function() {
				// if ($("#panel-prod").css("display") == 'none') {
				// 	$("#panel-prod").css("display", "block");
					
				// 	// Reset drawings
					
				// } else {
				// 	$("#panel-prod").css("display", "none");
				// }

				var panel_title = 'Case Study';

				// PANEL - CASE STUDY
				if (panel_id_byTitle(panel_title) == null) {
					$.jsPanel({
						position:    {my: "right-center", at: "right-center", offsetY: 15},
						theme:       "rebeccapurple",
						contentSize: {width: 450, height: 380},
						headerTitle: panel_title,
						content:    
						
							// DIV Step #1 - Selecao rota
							"<div id='step1' class='div-steps' style='display:block'>" +
								"<h2>Step 1 - Route Selection</h2>" +
								"<br/>" +

								"<span>Conversion technology:&nbsp;&nbsp;</span>" +
							//	"<input type='text' name='rota' list='rota'/><datalist id='rota'>" +
							//	"<option>Fischer-Tropsch</option></datalist>" +

								"<select name='rota' id='rota'>" +
								"<option>--</option>" +
								"<option>Fischer-Tropsch</option></select>" +
								"<option>HEFA-SPK</option></select>" +
								"<br/><br/><br/>" +

								"<span>Feedstock:&nbsp;&nbsp;</span>" +
							//	"<input type='text' name='fstock' list='fstock'/><datalist id='fstock'>" +
							//	"<option>Eucalyptus</option></datalist>" +

								"<select name='fstock' id='fstock'>" +
								"<option>--</option>" +
								"<option>Eucalyptus</option></select>" +
								"<br/><br/><br/>" +
							
								"<span>Map:&nbsp;&nbsp;</span>" +
							//	"<input type='text' name='eucaliptoMaps' list='eucaliptoMaps'/><datalist id='eucaliptoMaps'>" +
							//	"<option>Continue without maps</option>" +
							//	"<option>Eucalyptus suitability</option>" +
							//	"<option>Cost of harvested wood</option>" +
							//	"<option>Wood yield</option></datalist>" +

								"<select name='eucaliptoMaps' id='eucaliptoMaps'>" +
								"<option>Continue without maps</option>" +
								"<option>Eucalyptus suitability</option>" +
								"<option>Cost of harvested wood</option>" +
								"<option>Wood yield</option></select>" +
								"<br/><br/>" +

								// Botao next
								"<div class='bt-next'>" +
									"<button class='step1-next bt-style' type='button'>" +
										"<span style='color:grey'>Next&nbsp;&nbsp;\></span></button>" +
								"</div>" +
							"</div>" +
							
							// DIV Step #2 - Selecao do tipo de instalacao
							"<div id='step2' class='div-steps' style='display:none'>" +
								"<h2>Step 2 - Industrial configuration</h2>" +
								"<br/>" +

								"<span>Integration strategy:&nbsp;&nbsp;</span>" +
							//	"<input type='text' name='tipoInstalacao' list='tipoInstalacao'/><datalist id='tipoInstalacao'>" +
							//	"<option>Greenfield</option>" +
							//	"<option>Co-locating</option></datalist>" +

								"<select name='tipoInstalacao' id='tipoInstalacao'>" +
								"<option>--</option>" +
								"<option>Greenfield</option>" +
								"<option>Co-locating</option></select>" +
								"<br/><br/>" +

								"<span>Location:&nbsp;&nbsp;</span>" +
								"<span id='nomeMunicipio'> ...</span>" +
								"<br/><br/><br/>" +

								"<span>Output capacity (t/day, Jet Fuel):&nbsp;&nbsp;</span>" +
							//	"<input type='text' name='capacidade' list='capacidade'/><datalist id='capacidade'>" +
							//	"<option>21,6</option>" +
							//	"<option>54,4</option>" +
							//	"<option>80,0</option>" +
							//	"<option>160,0</option></datalist>" +

								"<select name='capacidade' id='capacidade'>" +
								"<option>--</option>" +
								"<option>21,6</option>" +
								"<option>54,4</option>" +
								"<option>80,0</option>" +
								"<option>160,0</option></select>" +
								"<br/><br/>" +	

								"<span>Input requirement:&nbsp;&nbsp;</span>" +
								"<span id='inputReq'>...  t/day (biomass, dry basis)</span>" +
								"<br/><br/>" +

								"<span>Co-products output:&nbsp;&nbsp;</span>" +
								"<div style='padding-left:1em;padding-top:0.5em'><ul'><li id='diesel'>Diesel</li>" + 
								"<li id='naphtha'>Naphtha</li>" +
								"<li id='electricity'>Electricity</li></ul><div>" +
								"<br/><br/>" +

							/* SELECAO PONTOS
								"<span>Selection of point enabled:&nbsp;&nbsp;</span>" +
								"<span style='color:red'>... click on the map ...</span>" +
								"<br/><br/>" +
							*/

							/*	ENTRADA DA CAPACIDADE DE PRODUCAO
								"<span>Unit production capacity:&nbsp;&nbsp;</span>" +
								"<input type='text' name='volumeProducao'/>" +
								"<span style='color:grey'>&nbps</span>" +
							*/

								// Botao back
								"<div class='bt-back'>" +
									"<button class='step2-back bt-style' type='button'>" +
										"<span style='color:grey'>\<&nbsp;&nbsp;Back</span></button>" +
								"</div>" +

								// Botao next
							/*
								"<div class='bt-next'>" +
									"<button class='step2-next bt-style' type='button'>" +
										"<span style='color:grey'>Next&nbsp;&nbsp;\></span></button>" +
								"</div>" +
							*/

								// Botao calculate
								"<div class='bt-calc'>" +
									"<button class='step2-calc bt-style' type='button'>" +
										"<span style='color:grey'>Calculate&nbsp;</span></button>" +
								"</div>" +
							"</div>",

							// DIV Step #3 - Informacoes producao
						/*
							"<div id='step3' class='div-steps' style='display:none'>" +
								"<h2>Step 3 - Production Information</h2>" +
								"<br/>" +

							/*	ENTRADA DA CAPACIDADE DE PRODUCAO
								"<span>Unit production capacity:&nbsp;&nbsp;</span>" +
								"<input type='text' name='volumeProducao'/>" +
								"<span style='color:grey'>&nbps</span>" +
							/*

								// Botao back
								"<div class='bt-back'>" +
									"<button class='step3-back bt-style' type='button'>" +
										"<span style='color:grey'>\<&nbsp;&nbsp;Back</span></button>" +
								"</div>" +

							
								// Botao next
								"<div class='bt-next'>" +
									"<button class='step3-next bt-style' type='button'>" +
										"<span style='color:grey'>Next&nbsp;&nbsp;\></span></button>" +
								"</div>" +
							
							"</div>",
						*/

						/* DIV Clean

							// DIV Step #
							"<div id='step2' class='div-steps' style='display:none'>" +
								"<span>Other step&nbsp;&nbsp;</span>" +
							
								// Botao back
								"<div class='bt-back'>" +
									"<button class='step#""-back bt-style' type='button'>" +
										"<span style='color:grey'>\<&nbsp;&nbsp;Back</span></button>" +
								"</div>" +

								// Botao next
								"<div class='bt-next'>" +
									"<button class='step#""-next bt-style' type='button'>" +
										"<span style='color:grey'>Next&nbsp;&nbsp;\></span></button>" +
								"</div>" +
							"</div>",
						*/					

						callback:    function () {
							this.content.css("padding", "15px");

						//	var output_title = null, new_panel = true;

							// Selecao da rota
							//$("input[name='rota']").on('input', function(e){
							$("#rota").on('change', function(){
								//route = $("input[name='rota']").val()
								route = this.value;
							});

							// Selecao do feedstock
							//$("input[name='fstock']").on('input', function(e){
							$("#fstock").on('change', function(){
								//feedstock = $("input[name='fstock']").val()
								feedstock = this.value;
							});

							//$("input[name='eucaliptoMaps']").on('input', function(e){
							$("#eucaliptoMaps").on('change', function(){
								//console.debug($("input[name='eucaliptoMaps']").val());
								console.debug(this.value);

								//var selecionado = $("input[name='eucaliptoMaps']").val();
								selecionado = this.value;

								// REMOCAO DE OUTROS PONTOS DO MAPA
								var layers = [];
								map.eachLayer(function(layer) {
									if( layer instanceof L.TileLayer )
										layers.push(layer);
								});
								layers.forEach(function(l) {
									if (l.options.layers === l_aptidao_eucalipto 
										|| l.options.layers === l_custos_eucalipto
										|| l.options.layers === l_produtividade_eucalipto) {
										l.remove();
									}
								});

								if (layers_avail.aptidao_eucalipto.visible) {
									layers_avail.aptidao_eucalipto.visible = false;
									removePanel(layers_avail.aptidao_eucalipto.id_panel);
									layers_avail.aptidao_eucalipto.id_panel = null;
								} else if (layers_avail.custos_eucalipto.visible) {
									layers_avail.custos_eucalipto.visible = false;
									removePanel(layers_avail.custos_eucalipto.id_panel);
									layers_avail.custos_eucalipto.id_panel = null;
								} else if (layers_avail.produtividade_eucalipto.visible) {
									layers_avail.produtividade_eucalipto.visible = false;
									removePanel(layers_avail.produtividade_eucalipto.id_panel);
									layers_avail.produtividade_eucalipto.id_panel = null;
								}

								if (selecionado === "Eucalyptus suitability") {
									var aptidao_eucalipto = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_aptidao_eucalipto, format: 'image/png', transparent: true });
									map.addLayer(aptidao_eucalipto);

									layers_avail.aptidao_eucalipto.visible = true;
									var current_layer = layers_avail.aptidao_eucalipto.title;
									legend_img_src = './images/legendas/aptidao_eucalipto.png';
									img_size = "height='80%' style='margin-left:1.5em'";
									img_id = 'aptidao_eucalipto';
									leg_w = 172;
									leg_h = 115;
									leg_pos_l = 10;
									leg_pos_h = windowHeight - (leg_h + 50);
								} else if (selecionado === "Cost of harvested wood") {
									var custos_eucalipto = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_custos_eucalipto, format: 'image/png', transparent: true });
									map.addLayer(custos_eucalipto);

									layers_avail.custos_eucalipto.visible = true;
									var current_layer = layers_avail.custos_eucalipto.title;
									legend_img_src = './images/legendas/custos_eucalipto.png';
									img_size = "height='90%' style='margin-left: 1.5em'";
									img_id = 'custos_eucalipto';
									leg_w = 172;
									leg_h = 333;
									leg_pos_l = 10;
									leg_pos_h = windowHeight - (leg_h + 50);								
								} else if (selecionado === "Wood yield") {
									var produtividade_eucalipto = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_produtividade_eucalipto, format: 'image/png', transparent: true });
									map.addLayer(produtividade_eucalipto);

									layers_avail.produtividade_eucalipto.visible = true;
									var current_layer = layers_avail.produtividade_eucalipto.title;
									legend_img_src = './images/legendas/produtividade_eucalipto.png';
									img_size = "height='80%'";
									img_id = 'produtividade_eucalipto';
									leg_w = 162;
									leg_h = 183;
									leg_pos_l = 10;
									leg_pos_h = windowHeight - (leg_h + 50);
								}

								// ABRE A LEGENDA
								if (selecionado === "Eucalyptus suitability"
										|| selecionado === "Cost of harvested wood"
										|| selecionado === "Wood yield") {
									$.jsPanel({
										position:    {
											top: leg_pos_h,
											left: leg_pos_l
										},
										theme:       "rebeccapurple",
										contentSize: {width: leg_w, height: leg_h},
										headerTitle: current_layer,
										content:	"<div id='legend-div' style='height:100%'>" +
														"<img id='" + img_id + "' src='" + legend_img_src + "' " + img_size + ">" +
													"</div>",
										callback:    function () {
											this.content.css("padding", "15px");

											this.find(".jsPanel-btn-smallify").remove();
											this.find(".jsPanel-btn-minimize").remove();
											this.find(".jsPanel-btn-maximize").remove();

											if (this.headerTitle() === layers_avail.aptidao_eucalipto.title) {
												// aptidao_eucalipto
												layers_avail.aptidao_eucalipto.id_panel = jsPanel.id;
											} else if (this.headerTitle() === layers_avail.custos_eucalipto.title) {
												// custos_eucalipto
												layers_avail.custos_eucalipto.id_panel = jsPanel.id;
												$("#legend-div").append("<br/><br/><span>* Costs (€. GJ" + 
													"<span style='vertical-align:super;'>-1</span>)</span>");
											} else if (this.headerTitle() === layers_avail.produtividade_eucalipto.title) {
												// produtividade_eucalipto
												layers_avail.produtividade_eucalipto.id_panel = jsPanel.id;
												$("#legend-div").append("<br/><br/><span>* Yield (m" + 
													"<span style='vertical-align:super;'>3</span>" +
													".ha<span style='vertical-align:super;'>-1</span>" +
													".year<span style='vertical-align:super;'>-1</span>)" +
												"</span>");
											}
										}
									});	
								}
							});

							//$("input[name='capacidade']").on('input', function(e){
							$("#capacidade").on('change', function(){
								//console.debug($("input[name='capacidade']").val());
								console.debug(this.value);

								//capacidade = $("input[name='capacidade']").val();
								capacidade = this.value;

								if (capacidade != '' && capacidade != '--') {
									//Output
									var output_value = parseFloat(capacidade.replace(",", ".")) / 0.16 / 0.17;

									$("#inputReq").text(Math.round(output_value) + " t/day (biomass, dry basis)");
									$("#inputReq").css("color", "blue");

									//Co-products
									var diesel_value = (parseFloat(capacidade.replace(",", ".")) * 0.62) / 0.16;
									var naphtha_value = (parseFloat(capacidade.replace(",", ".")) * 0.22) / 0.16;
									var electricity_value = parseFloat(capacidade.replace(",", ".")) / 0.16 / 0.17 * 18.07 * 0.015;

									$("#diesel").text("Diesel: " + parseInt(diesel_value) + "  t/day");
									$("#diesel").css("color", "blue");

									$("#naphtha").text("Naphtha: " + parseInt(naphtha_value) + "  t/day");
									$("#naphtha").css("color", "blue");

									$("#electricity").text("Electricity: " + parseInt(electricity_value) + "  MWh/day");
									$("#electricity").css("color", "blue");

									//tipo_instalacao = $("input[name='tipoInstalacao']").val();
									
									// REVAP
									if (capacidade === '21,6' && tipo_instalacao === "Co-locating") {
										curva_oferta_png = 'curva_oferta_revap_216.png';
										resultado_png = 'results_revap_216.png';
									} else if (capacidade === '54,4' && tipo_instalacao === "Co-locating") {
										curva_oferta_png = 'curva_oferta_revap_544.png';
										resultado_png = 'results_revap_544.png';
									} else if (capacidade === '80,0' && tipo_instalacao === "Co-locating") {
										curva_oferta_png = 'curva_oferta_revap_80.png';
										resultado_png = 'results_revap_80.png';
									} else if (capacidade === '160,0' && tipo_instalacao === "Co-locating") {
										curva_oferta_png = 'curva_oferta_revap_160.png';
										resultado_png = 'results_revap_160.png';
									}

									// ESPIGAO
									if (capacidade === '21,6' && tipo_instalacao === "Greenfield") {
										curva_oferta_png = 'curva_oferta_espigao_216.png';
										resultado_png = 'results_espigao_216.png';
									} else if (capacidade === '54,4' && tipo_instalacao === "Greenfield") {
										curva_oferta_png = 'curva_oferta_espigao_544.png';
										resultado_png = 'results_espigao_544.png';
									} else if (capacidade === '80,0' && tipo_instalacao === "Greenfield") {
										curva_oferta_png = 'curva_oferta_espigao_80.png';
										resultado_png = 'results_espigao_80.png';
									} else if (capacidade === '160,0' && tipo_instalacao === "Greenfield") {
										curva_oferta_png = 'curva_oferta_espigao_160.png';
										resultado_png = 'results_espigao_160.png';
									}

								} else {
									//Output
									$("#inputReq").text("... t/day (biomass, dry basis)");
									$("#inputReq").css("color", "black");

									//Co-products
									$("#diesel").text("Diesel");
									$("#diesel").css("color", "black");

									$("#naphtha").text("Naphtha");
									$("#naphtha").css("color", "black");

									$("#electricity").text("Electricity");
									$("#electricity").css("color", "black");
								}

							});

							// Seleção do tipo de unidade industrial
							//$("input[name='tipoInstalacao']").on('input', function(e){
							$("#tipoInstalacao").on('change', function(){
								//console.debug($("input[name='tipoInstalacao']").val());
								console.debug(this.value);
							
							/*
								$.ajax({
									"async"			:	false, // false so the data is only used after being properly downloaded
								//	"dataType"		:	"jsonp",
								//	"method"		:	"GET",
									type			: "GET",
									"crossDomain"	:	true,
									//url		:	this.url+"/helpers/tc_getStatsData_new.php?"+str,
									"url"			:	"http://localhost:8080/municipios/buscar?ibgeCode=1501956",
								/*
									"headers": {
										"accept"						: "application/json",
										"Access-Control-Allow-Origin"	: "*"
									},
								
									success : function(data){
										//var municipio = JSON.parse(data);
										//$("#nomeMunicipio").text(municipio["nomeMunicipio"]);

										var municipio = data[0].nomeMunicipio;
										$("#nomeMunicipio").text(municipio);
										$("#nomeMunicipio").css("color", "blue");
									}
								});
							*/

								//tipo_instalacao = $("input[name='tipoInstalacao']").val();
								tipo_instalacao = this.value;

								if (tipo_instalacao === "Greenfield") {
									// REMOCAO DE OUTROS PONTOS DO MAPA
									var layers = [];
									map.eachLayer(function(layer) {
										if( layer instanceof L.TileLayer )
											layers.push(layer);
									});
									layers.forEach(function(l) {
										if (l.options.layers === l_revap_buffer_50km || l.options.layers === l_custos_revap) {
											l.remove();
										}
									});
									
									// REMOVE MARCADOR
									if (revap != undefined && revap != '') {
										map.removeLayer(revap);
									};
									
									espigao = L.marker(l_espigao).bindPopup("Greenfield at <b>" + l_espigao.toString() + "</b>").openPopup();
									map.addLayer(espigao);

									var espigao_buffer = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_espigao_buffer_50km, format: 'image/png', transparent: true });
									map.addLayer(espigao_buffer);

									// Posiciona o mapa na localização
									map.flyTo(l_espigao, 9);

									$("#nomeMunicipio").text("REGENTE FEIJÓ");
									$("#nomeMunicipio").css("color", "blue");
								} else if (tipo_instalacao === "Co-locating") {
									// REMOCAO DE OUTROS PONTOS DO MAPA
									var layers = [];
									map.eachLayer(function(layer) {
										if( layer instanceof L.TileLayer )
											layers.push(layer);
									});
									layers.forEach(function(l) {
										if (l.options.layers === l_espigao_buffer_50km || l.options.layers === l_custos_espigao) {
											l.remove();
										}
									});

									// REMOVE MARCADOR
									if (espigao != undefined && espigao != '') {
										map.removeLayer(espigao);
									};
									
									revap = L.marker(l_revap).bindPopup("REVAP at <b>" + l_revap.toString() + "</b>").openPopup();
									map.addLayer(revap);

									var revap_buffer = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_revap_buffer_50km, format: 'image/png', transparent: true });
									map.addLayer(revap_buffer);
									
									// Posiciona o mapa na localização
									map.flyTo(l_revap, 9);

									$("#nomeMunicipio").text("SÃO JOSÉ DOS CAMPOS");
									$("#nomeMunicipio").css("color", "blue");
								} else {
									$("#nomeMunicipio").text(" ...");
									$("#nomeMunicipio").css("color", "black");
								}

								// Seleção de um ponto no mapa
								var marker = {};

							/* SELECAO DE PONTO NO MAPA
								function onMapClick(e) {
									if (marker != undefined) {
										map.removeLayer(marker);
									};
									
									marker = L.marker(e.latlng).addTo(map);
									marker.bindPopup("Your point at <b>" + e.latlng.toString() + "</b>").openPopup();
									//map.off('click', onMapClick);
								}

								map.on('click', onMapClick);
							*/
							});

							// Botao next (Step #1)
							$("button.step1-next").on("click", function() {
								if ((route === "" || route === "--") && (feedstock === "" || feedstock === "--")) {
									$.alert({
										boxWidth: '40%',
										title: '<i class="fas fa-exclamation-triangle" style="color:red"></i>',
										content: 'Please select the <b>Conversion technology</b> and the <b>Feedstock</b>.',
										useBootstrap: false
									});
								} else if (route === "" || route === "--") {
									$.alert({
										boxWidth: '30%',
										title: '<i class="fas fa-exclamation-triangle" style="color:red"></i>',
										content: 'Please select the <b>Conversion technology</b>.',
										useBootstrap: false
									});
								} else if (feedstock === "" || feedstock === "--") {
									$.alert({
										boxWidth: '30%',
										title: '<i class="fas fa-exclamation-triangle" style="color:red"></i>',
										content: 'Please select the <b>Feedstock</b>.',
										useBootstrap: false
									});
								} else {
									$("#step1").css("display", "none");
									$("#step2").css("display", "block");
								}
							});

							// Botao back (Step #2)
							$("button.step2-back").on("click", function() {
								$("#step2").css("display", "none");
								$("#step1").css("display", "block");
							});

						/*
							// Botao next (Step #2)
							$("button.step2-next").on("click", function() {
								$("#step2").css("display", "none");
								$("#step3").css("display", "block");							
							});
						*/

							// Botao calculate (Step #2)
							$("button.step2-calc").on("click", function() {
								if ((tipo_instalacao === "" || tipo_instalacao === "--") 
										&& (capacidade === "" || capacidade === "--")) {
									$.alert({
										boxWidth: '40%',
										title: '<i class="fas fa-exclamation-triangle" style="color:red"></i>',
										content: 'Please select the <b>Integration Strategy</b> and the <b>Output capacity</b>.',
										useBootstrap: false
									});
								} else if (tipo_instalacao === "" || tipo_instalacao === "--") {
									$.alert({
										boxWidth: '30%',
										title: '<i class="fas fa-exclamation-triangle" style="color:red"></i>',
										content: 'Please select the <b>Integration Strategy</b>.',
										useBootstrap: false
									});
								} else if (capacidade === "" || capacidade === "--") {
									$.alert({
										boxWidth: '30%',
										title: '<i class="fas fa-exclamation-triangle" style="color:red"></i>',
										content: 'Please select the <b>Output capacity</b>.',
										useBootstrap: false
									});
								} else {
									// REMOCAO DE LAYERS DO MAPA
									var layers = [];
									map.eachLayer(function(layer) {
										if( layer instanceof L.TileLayer )
											layers.push(layer);
									});
									layers.forEach(function(l) {
										if (l.options.layers === l_aptidao_eucalipto 
											|| l.options.layers === l_custos_eucalipto
											|| l.options.layers === l_produtividade_eucalipto) {
											l.remove();
										}
									});

									if (layers_avail.aptidao_eucalipto.visible) {
										layers_avail.aptidao_eucalipto.visible = false;
										removePanel(layers_avail.aptidao_eucalipto.id_panel);
										layers_avail.aptidao_eucalipto.id_panel = null;
									} else if (layers_avail.produtividade_eucalipto.visible) {
										layers_avail.produtividade_eucalipto.visible = false;
										removePanel(layers_avail.produtividade_eucalipto.id_panel);
										layers_avail.produtividade_eucalipto.id_panel = null;
									}								

									// ESPIGAO
									if (tipo_instalacao === "Greenfield") {
										var custos_espigao = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_custos_espigao, format: 'image/png', transparent: true });
										map.addLayer(custos_espigao);
									
									// REVAP
									} else if (tipo_instalacao === "Co-locating") {
										var custos_espigao = L.tileLayer.wms('http://35.247.202.68/geoserver/ows?', { layers: l_custos_revap, format: 'image/png', transparent: true });
										map.addLayer(custos_espigao);
									}

									// ABRE LEGENDA
									if (layers_avail.custos_eucalipto.visible) {
										removePanelbyTitle(layers_avail.custos_eucalipto.title);
										layers_avail.custos_eucalipto.visible = false;
										layers_avail.custos_eucalipto.id_panel = null;
									}
									
									if (layers_avail.custos_eucalipto_transporte.visible 
											&& $("#jsPanel-" + layers_avail.custos_eucalipto_transporte.id_panel).length > 0) {
										$("#jsPanel-" + layers_avail.custos_eucalipto_transporte.id_panel).css("left", windowWidth / 1.5);
									} else {
										layers_avail.custos_eucalipto_transporte.visible = true;
										var current_layer = layers_avail.custos_eucalipto_transporte.title;
										legend_img_src = './images/legendas/custos_eucalipto_transporte.png';
										img_size = "height='85%' style='margin-left: 1.5em'";
										img_id = 'custos_eucalipto_transporte';
										leg_w = 152;
										leg_h = 230;
										leg_pos_l = windowWidth / 1.5;
										leg_pos_h = windowHeight - (leg_h + 50);

										$.jsPanel({
											position:    {
												top: leg_pos_h,
												left: leg_pos_l
											},
											theme:       "rebeccapurple",
											contentSize: {width: leg_w, height: leg_h},
											headerTitle: current_layer,
											content:	"<div id='legend-div' style='height:100%'>" +
															"<img id='" + img_id + "' src='" + legend_img_src + "' " + img_size + ">" +
														"</div>",
											callback:    function () {
												this.content.css("padding", "15px");

												this.find(".jsPanel-btn-smallify").remove();
												this.find(".jsPanel-btn-minimize").remove();
												this.find(".jsPanel-btn-maximize").remove();

												if (this.headerTitle() === layers_avail.custos_eucalipto_transporte.title) {
													// custos_eucalipto
													layers_avail.custos_eucalipto_transporte.id_panel = jsPanel.id;
													$("#legend-div").append("<br/><br/><span>* Costs (€. GJ" + 
														"<span style='vertical-align:super;'>-1</span>)</span>");
												}
											}
										});										
									}

								/* OPCAO PARA EVITAR ABERTURA DE MULTIPLAS JANELAS
									output_title = "Wood supply curve";

									var id_panel = panel_id_byTitle(output_title);
									if (id_panel != null) {
										var output = $("#jsPanel-" + id_panel).find("img").attr("src").replace("images/", "");
										if (output === curva_oferta_png) {
											new_panel = false;
										} else {
											new_panel = true;
										}
									}

									if (new_panel) {

									}
								*/

									// Janela Curva Oferta
									removePanelbyTitle("Wood supply curve");
									$.jsPanel({
										//position:    {my: "left-center", at: "left-center", offsetY: 15},
										position:    {
												top: 65,
												left: 36
											},
										theme:       "rebeccapurple",
										contentSize: {width: 500, height: 300},
										headerTitle: "Wood supply curve",
										//content:    "<div id='placeholder' style='width:90%;height:90%'></div>",
										content:	"<img src='images/" + curva_oferta_png + "' height='100%' width='100%'>",
										callback:    function () {
											this.content.css("padding", "15px");
											
										}
									});

									// Janela Resultados
									removePanelbyTitle("Results");
									$.jsPanel({
										//position:    {my: "right-top", at: "right-top", offsetY: 15},
										position:    {
												top: 445,
												left: 36
											},
										theme:       "rebeccapurple",
										contentSize: {width: 400, height: 200},
										headerTitle: "Results",
										//content:    "<div id='placeholder' style='width:90%;height:90%'></div>",
										content:	"<div class='div-steps' style='display:block'>" +
														"<img src='images/" + resultado_png + "' height='80%' width='100%'>" +
														"<br/><br/>" +

														// Botao comparacao
														"<div class='bt-comparision'>" +
															"<button class='comparision bt-style' type='button'>" +
																"<span style='color:grey'>Comparision&nbsp;&nbsp;</span></button>" +
														"</div>" +
													"</div>",
										callback:    function () {
											this.content.css("padding", "15px");

											$("button.comparision").on("click", function() {
												// Janela Comparacao
												if (panel_id_byTitle("Results comparision") == null) {
													$.jsPanel({
														position:    "center",
														theme:       "rebeccapurple",
														contentSize: {width: 540, height: 430},
														headerTitle: "Results comparision",
														//content:    "<div id='placeholder' style='width:90%;height:90%'></div>",
														content:	"<img src='images/comparison_colocating_greenfield.png' height='100%' width='100%'>",
														callback:    function () {
															this.content.css("padding", "15px");

														}
													});	
												}
											});
										}
									});

									// Janela Recomecar
									removePanelbyTitle("Restart ...");
									$.jsPanel({
										position:    {
												top: windowHeight - (windowHeight / 4.5),
												left: windowWidth - (windowWidth / 5)
											},
										theme:       "rebeccapurple",
										contentSize: {width: 230, height: 110},
										headerTitle: "Restart ...",
										content:    "<div class='div-steps' style='display:block'>" +
														"Click on the button bellow to restart the system from the begining." +
														"<br/><br/>" +

														// Botao comparacao
														"<div class='bt-restart'>" +
															"<button class='recomecar bt-style' type='button'>" +
																"<span style='color:grey'>Restart ...</span></button>" +
														"</div>" +
													"</div>",
										callback:    function () {
											this.content.css("padding", "15px");
											
											this.find(".jsPanel-btn-smallify").remove();
											this.find(".jsPanel-btn-minimize").remove();
											this.find(".jsPanel-btn-maximize").remove();

											// Botao recomecar
											$("button.recomecar").on("click", function() {
												// FECHA TODAS AS JANELAS
												removeAllPanels();

												// REMOCAO DE LAYERS DO MAPA
												var layers = [];
												map.eachLayer(function(layer) {
													if( layer instanceof L.TileLayer )
														layers.push(layer);
												});
												layers.forEach(function(l) {
													if (typeof l.options.layers != "undefined") {
														l.remove();
													}
												});

												// REMOVE MARCADOR
												if (revap != undefined && revap != '') {
													map.removeLayer(revap);
												};

												if (espigao != undefined && espigao != '') {
													map.removeLayer(espigao);
												};												

												// Posiciona o mapa na localização
												map.flyTo(init_map, init_zoom);

												// Reinicia as variaveis
												route = feedstock = tipo_instalacao = capacidade = "";
											});
										}
									});
								}
							});

						/*
							// Botao back (Step #3)
							$("button.step3-back").on("click", function() {
								$("#step3").css("display", "none");
								$("#step2").css("display", "block");
							});

							// Botao next (Step #3)
							$("button.step3-next").on("click", function() {

							});
						*/

						}
					});
				}
			});

			$("button.leaflet-control-graph-icon").on("click", function() {
			/*
				$.jsPanel({
					position:    {my: "left-center", at: "left-center", offsetY: 15},
					theme:       "rebeccapurple",
					contentSize: {width: 700, height: 500},
					headerTitle: "Wood supply curve",
					content:     "<div id='placeholder' style='width:90%;height:90%'></div>",
					callback:    function () {
						this.content.css("padding", "15px");
						$(function() {
							var d1 = [];
							for (var i = 0; i < 14; i += 0.5) {
								d1.push([i, Math.sin(i)]);
							}

							var d2 = [[0, 3], [4, 8], [8, 5], [9, 13]];

							var d3 = [];
							for (var i = 0; i < 14; i += 0.5) {
								d3.push([i, Math.cos(i)]);
							}

							var d4 = [];
							for (var i = 0; i < 14; i += 0.1) {
								d4.push([i, Math.sqrt(i * 10)]);
							}

							var d5 = [];
							for (var i = 0; i < 14; i += 0.5) {
								d5.push([i, Math.sqrt(i)]);
							}

							var d6 = [];
							for (var i = 0; i < 14; i += 0.5 + Math.random()) {
								d6.push([i, Math.sqrt(2*i + Math.sin(i) + 5)]);
							}

							$.plot("#placeholder", [{
								data: d1,
								lines: { show: true, fill: true }
							}, {
								data: d2,
								bars: { show: true }
							}, {
								data: d3,
								points: { show: true }
							}, {
								data: d4,
								lines: { show: true }
							}, {
								data: d5,
								lines: { show: true },
								points: { show: true }
							}, {
								data: d6,
								lines: { show: true, steps: true }
							}]);
						});
					}
				});
			*/
			});

		/* MODAL
			$.jsPanel({
				paneltype:   'modal',
				headerTitle: 'modal jsPanel',
				theme:       'success',
				show:        'animated fadeInDownBig',
				content:     ' ... ',
				callback:    function(panel){
					$("input:first", this).focus();
					$("button", this.content).click(function(){panel.close()});
				}
			});
		*/

			// PAINEL DE ABERTURA
			$.jsPanel({
				position:    "center",
				theme:       "rebeccapurple",
				headerControls: {
					maximize:  true,
					minimize:  true,
					normalize: false,
					smallify:  false,
					iconfont:  'jsglyph'
				},
				contentSize: {width: 800, height: 500},
				headerTitle: "Database Management System",
				content:    "<div style='width:90%;height:90%;padding-left:3em'>" +
							
								"<p style='font-size:1.2em;text-align:justify'>Since 2017 the University of Campinas (Unicamp) and Boeing Research and Technology - " +
								"Brazil (BR&TB), as part of the Boeing Company (Boeing), have collaborative efforts with " +
								"the aim of building a Data Management System (DBMS) that contains structured information " +
								"related to selected feedstocks, such as suitability, yields, costs, required and existing " +
								"infrastructure, for the sustainable production of bio-jet fuels, in Brazil.</p>" +

								"<p style='font-size:1.2em;text-align:justify'>More specifically, this systems will provide easy access to relevant information/data " +
								"related to promising feedstock and specific supply-chains in Brazil; the concept of regional " +
								"hubs has been explored within the assessments and data gathering. The feedstocks that have " +
								"been dealt at this point in the system is eucalyptus.</p>" +

								"<p style='font-size:1.2em;text-align:justify'>The agreement Boeing-Unicamp is set in the context of the JRC (Joint Research Centre " +
								"for Sustainable Aviation Biofuels) between Boeing and Embraer that has as one of its goals " +
								"to fund research projects and participate in other aviation biofuels related " +
								"activities.</p>" +

								"<div style='text-align:left;margin-top:3em;margin-left:3em'>" +
								"<p><b>Developed by:</b></p><br/>" +
							//		"<img src='images/logo_boeing.png' height='35%' width='35%' style='margin-right:10em;margin-left:-4em;'>" +
									"<img src='images/logo_unicamp.png' height='12%' width='12%' style='margin-right:10em'>" +
									"<img src='images/logo_geomeridium.png' height='28%' width='28%' style='top:1em'>" +
								"</div>" +
								
								// Botao next
								"<div class='bt-cstudy'>" +
									"<button class='case-study bt-style' style='background-color:#663399;height:2em' type='button'>" +
										"<span style='color:white'>&nbsp;Go ...&nbsp;</span></button>" +
								"</div>" +
				
							"</div>",
				callback:    function () {
					this.content.css("padding", "15px");

					this.find(".jsPanel-btn-smallify").remove();
					this.find(".jsPanel-btn-minimize").remove();
					this.find(".jsPanel-btn-maximize").remove();					

					$("button.case-study").on("click", function() {
						$("#jsPanel-1").remove();
					});
				}
			});

			// LEGENDA
			map.on('overlayadd', function(eventLayer){
				var new_panel = true, panel_id, img_id, imgs_h = 0;

				if (eventLayer.name === layers_avail.uso_cobertura.title){
					// uso_cobertura
					//map.addControl(popuLegend);

					layers_avail.uso_cobertura.visible = true;
					var current_layer = layers_avail.uso_cobertura.title;
					legend_img_src = './images/legendas/uso_cobertura.png';
					img_size = "height='100%' width='230'";
					img_id = 'uso_cobertura';
					leg_w = 260;
					leg_h = 250;
					leg_pos_l = 10;
					leg_pos_h = windowHeight - (leg_h + 50);
				} else if (eventLayer.name === layers_avail.declividade.title){
					// declividade

					layers_avail.declividade.visible = true;
					var current_layer = layers_avail.declividade.title;
					legend_img_src = './images/legendas/declividade.png';
					img_size = "height='100%' width='100%'";
					img_id = 'declividade'
					leg_w = 152;
					leg_h = 147;
					leg_pos_l = 10;
					leg_pos_h = windowHeight - (leg_h + 50);
				} else if (eventLayer.name === layers_avail.municipios.title){
					// municipios

					if (layers_avail.estados.visible) {
						new_panel = false;
						panel_id = layers_avail.municipios.id_panel = layers_avail.estados.id_panel;
						//imgs_h += layers_avail.estados.img_h;
					}
					
					if (layers_avail.areas_no_go.visible) {
						new_panel = false;
						panel_id = layers_avail.municipios.id_panel = layers_avail.areas_no_go.id_panel;
						//imgs_h += layers_avail.areas_no_go.img_h;
					}

					var current_layer = layers_avail.municipios.title;
					legend_img_src = './images/legendas/municipios.png';
					img_size = "height='30px'";
					img_id = 'municipios';
					leg_w = 177;
					leg_h = 55;
					leg_pos_l = 10;
					leg_pos_h = windowHeight - (leg_h + 250);
					layers_avail.municipios.visible = true;
					layers_avail.municipios.img_h = parseInt(img_size.replace("height='", "").replace("px'", ""));
					imgs_h += layers_avail.municipios.img_h;
				} else if (eventLayer.name === layers_avail.estados.title){
					// estados

					if (layers_avail.municipios.visible) {
						new_panel = false;
						panel_id = layers_avail.estados.id_panel = layers_avail.municipios.id_panel;
						//imgs_h += layers_avail.municipios.img_h;
					}
					
					if (layers_avail.areas_no_go.visible) {
						new_panel = false;
						panel_id = layers_avail.estados.id_panel = layers_avail.areas_no_go.id_panel;
						//imgs_h += layers_avail.areas_no_go.img_h;
					}

					var current_layer = layers_avail.estados.title;
					legend_img_src = './images/legendas/estados.png';
					img_size = "height='35px'";
					img_id = 'estados';
					leg_w = 191;
					leg_h = 59;
					leg_pos_l = 10;
					leg_pos_h = windowHeight - (leg_h + 250);
					layers_avail.estados.visible = true;
					layers_avail.estados.img_h = parseInt(img_size.replace("height='", "").replace("px'", ""));
					imgs_h += layers_avail.estados.img_h;
				} else if (eventLayer.name === layers_avail.areas_no_go.title){
					// areas_no_go

					if (layers_avail.municipios.visible) {
						new_panel = false;
						panel_id = layers_avail.areas_no_go.id_panel = layers_avail.municipios.id_panel;
						//imgs_h += layers_avail.municipios.img_h;
					}
					
					if (layers_avail.estados.visible) {
						new_panel = false;
						panel_id = layers_avail.areas_no_go.id_panel = layers_avail.estados.id_panel;
						//imgs_h += layers_avail.estados.img_h;
					}

					var current_layer = layers_avail.areas_no_go.title;
					legend_img_src = './images/legendas/areas_no_go.png';
					img_size = "height='30px'";
					img_id = 'areas_no_go';
					leg_w = 180;
					leg_h = 55;
					leg_pos_l = 10;
					leg_pos_h = windowHeight - (leg_h + 250);
					layers_avail.areas_no_go.visible = true;
					layers_avail.areas_no_go.img_h = parseInt(img_size.replace("height='", "").replace("px'", ""));
					imgs_h += layers_avail.areas_no_go.img_h;
				}

				// ABRE A LEGENDA
				//removePanel(current_layer);			// caso ja esteja aberta
				if (!new_panel) {
					var actual_size = parseInt($("#jsPanel-" + panel_id).css("height").replace("px", ""));
					//var actual_size = parseInt($("#jsPanel-" + panel_id).find(".jsPanel-content").css("height").replace("px", ""));
					//var add_size = parseInt(img_size.replace("height='", "").replace("px'", ""));
					var new_size = actual_size + (imgs_h - 15);

					$("#jsPanel-" + panel_id).find("#legend-div").append("<img id='" + img_id + "' src='" + legend_img_src + "' " + img_size +
						"style='margin-top:0.2em'>");
					
					$("#jsPanel-" + panel_id).css("height", (new_size) + "px");
					$("#jsPanel-" + panel_id).find(".jsPanel-content").css("height", (new_size) + "px");
				} else {
					$.jsPanel({
						position:    {
							top: leg_pos_h,
							left: leg_pos_l
						},
						theme:       "rebeccapurple",
						contentSize: {width: leg_w, height: leg_h},
						headerTitle: current_layer,
						content:	"<div id='legend-div' style='height:100%'>" +
										"<img id='" + img_id + "' src='" + legend_img_src + "' " + img_size + ">" +
									"</div>",
						callback:    function () {
							this.content.css("padding", "15px");

							this.find(".jsPanel-btn-smallify").remove();
							this.find(".jsPanel-btn-minimize").remove();
							this.find(".jsPanel-btn-maximize").remove();

							if (this.headerTitle() === layers_avail.uso_cobertura.title) {
								// uso_cobertura
								layers_avail.uso_cobertura.id_panel = jsPanel.id;
								if (layers_avail.declividade.visible) {hidePanel(layers_avail.uso_cobertura.id_panel)}
							} else if (this.headerTitle() === layers_avail.declividade.title) {
								// declividade
								layers_avail.declividade.id_panel = jsPanel.id;
								if (layers_avail.uso_cobertura.visible) {hidePanel(layers_avail.uso_cobertura.id_panel)}
							} else if (this.headerTitle() === layers_avail.municipios.title) {
								// municipios
								layers_avail.municipios.id_panel = jsPanel.id;
								$(this).find('.jsPanel-title')[0].innerHTML = "Map Legend";
							} else if (this.headerTitle() === layers_avail.estados.title) {
								// estados
								layers_avail.estados.id_panel = jsPanel.id;
								$(this).find('.jsPanel-title')[0].innerHTML = "Map Legend";
							} else if (this.headerTitle() === layers_avail.areas_no_go.title) {
								// areas no-go
								layers_avail.areas_no_go.id_panel = jsPanel.id;
								$(this).find('.jsPanel-title')[0].innerHTML = "Map Legend";
							}
						}
					});	
				}

			});

			map.on('overlayremove', function(eventLayer){
				var redim_panel = false, panel_id, img_size;

				if (eventLayer.name === layers_avail.uso_cobertura.title){
					// uso_cobertura
					//removePanelbyTitle(layers_avail.uso_cobertura.title);
					
					removePanel(layers_avail.uso_cobertura.id_panel);
					layers_avail.uso_cobertura.id_panel = '';
					layers_avail.uso_cobertura.visible = false;
				} else if (eventLayer.name === layers_avail.declividade.title){
					//declividade
					//removePanelbyTitle(layers_avail.declividade.title);

					removePanel(layers_avail.declividade.id_panel);
					layers_avail.declividade.id_panel = '';
					layers_avail.declividade.visible = false;
					if (layers_avail.uso_cobertura.visible) {showPanel(layers_avail.uso_cobertura.id_panel)}
				} else if (eventLayer.name === layers_avail.municipios.title){
					// municipios
					//removePanelbyTitle(layers_avail.municipios.title);

					if (layers_avail.estados.visible || layers_avail.areas_no_go.visible) {
						redim_panel = true;
						img_size = parseInt($("#jsPanel-" + layers_avail.municipios.id_panel).find("#municipios").attr("height").replace("px",""));
						panel_id = layers_avail.municipios.id_panel;

						$("#jsPanel-" + layers_avail.municipios.id_panel).find("#municipios").remove();
					} else {
						removePanel(layers_avail.municipios.id_panel);
					}
					
					layers_avail.municipios.id_panel = '';
					layers_avail.municipios.visible = false;
				} else if (eventLayer.name === layers_avail.estados.title){
					// estados
					//removePanelbyTitle(layers_avail.estados.title);

					if (layers_avail.municipios.visible || layers_avail.areas_no_go.visible) {
						redim_panel = true;
						img_size = parseInt($("#jsPanel-" + layers_avail.estados.id_panel).find("#estados").attr("height").replace("px",""));
						panel_id = layers_avail.estados.id_panel;

						$("#jsPanel-" + layers_avail.estados.id_panel).find("#estados").remove();
					} else {
						removePanel(layers_avail.estados.id_panel);
					}

					layers_avail.estados.id_panel = '';
					layers_avail.estados.visible = false;
				} else if (eventLayer.name === layers_avail.areas_no_go.title){
					// areas_no_go
					//removePanelbyTitle(layers_avail.areas_no_go.title);

					if (layers_avail.municipios.visible || layers_avail.estados.visible) {
						redim_panel = true;
						img_size = parseInt($("#jsPanel-" + layers_avail.areas_no_go.id_panel).find("#areas_no_go").attr("height").replace("px",""));
						panel_id = layers_avail.areas_no_go.id_panel;

						$("#jsPanel-" + layers_avail.areas_no_go.id_panel).find("#areas_no_go").remove();
					} else {
						removePanel(layers_avail.areas_no_go.id_panel);
					}

					layers_avail.areas_no_go.id_panel = '';
					layers_avail.areas_no_go.visible = false;
				}

				if (redim_panel) {
					var actual_size = parseInt($("#jsPanel-" + panel_id).css("height").replace("px", ""));
					//var actual_size = parseInt($("#jsPanel-" + panel_id).find(".jsPanel-content").css("height").replace("px", ""));
					//var new_size = actual_size - (img_size - 25);
					var new_size = actual_size - (img_size - 20);

					$("#jsPanel-" + panel_id).find(".jsPanel-content").css("height", (new_size) + "px");
					$("#jsPanel-" + panel_id).css("height", (new_size) + "px");
				}
			});

		/*
			//Create the legend control
			var popuLegend = L.control();
			popuLegend.onAdd = function(map){
				var container = L.DomUtil.create('div', 'info');
				container.innerHTML = '<h3>Population</h3><ul id="popuLegend"><li>1000+</li><li>500+</li><li>etc..</li></ul>';
				return container;
			};
		*/

		})();

		/* Funções para retornar o tamanho da tela  */
		function getActualHeight() {
			var actualHeight = window.innerHeight ||
							document.documentElement.clientHeight ||
							document.body.clientHeight ||
							document.body.offsetHeight;

			return actualHeight;
		};

		function getActualWidth() {
			var actualWidth = window.innerWidth ||
							document.documentElement.clientWidth ||
							document.body.clientWidth ||
							document.body.offsetWidth;

			return actualWidth;
		};

		function removePanel (id_panel) {
			$("#jsPanel-" + id_panel).remove();
		}

		function hidePanel (id_panel) {
			$("#jsPanel-" + id_panel).hide();
		}

		function showPanel (id_panel) {
			$("#jsPanel-" + id_panel).show();
		}

		function removePanelbyTitle(panelToClose) {
			var jsPanels = $(".jsPanel-title");
			var currentID = jsPanel.id;

			if (jsPanels.length > 0) {
				//for (i=0;i <= jsPanels.length;i++) {
				for (i=0;i <= currentID;i++) {
					if ($("#jsPanel-" + (i+1)).find('.jsPanel-title').length != 0) {
						if ($("#jsPanel-" + (i+1)).find('.jsPanel-title')[0].innerHTML === panelToClose) {
							$("#jsPanel-" + (i+1)).remove();
						}
					}
				}
			}
		}

		function removeAllPanels() {
			var jsPanels = $(".jsPanel-title");
			var currentID = jsPanel.id;

			if (jsPanels.length > 0) {
				//for (i=0;i <= jsPanels.length;i++) {
				for (i=0;i <= currentID;i++) {
					if ($("#jsPanel-" + (i+1)).find('.jsPanel-title').length != 0) {
						$("#jsPanel-" + (i+1)).remove();
					}
				}
			}
		}

		function panel_id_byTitle(panelTitle) {
			var jsPanels = $(".jsPanel-title");
			var currentID = jsPanel.id;
			var id_panel = null;

			if (jsPanels.length > 0) {
				for (i=0;i <= currentID;i++) {
					if ($("#jsPanel-" + (i+1)).find('.jsPanel-title').length != 0) {
						if ($("#jsPanel-" + (i+1)).find('.jsPanel-title')[0].innerHTML === panelTitle) {
							id_panel = i+1;
						}
					}
				}
			}

			return id_panel;
		}

	</script>

</body>
</html>